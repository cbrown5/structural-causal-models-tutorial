<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introduction to structural causal modelling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="scm-tute_files/libs/clipboard/clipboard.min.js"></script>
<script src="scm-tute_files/libs/quarto-html/quarto.js"></script>
<script src="scm-tute_files/libs/quarto-html/popper.min.js"></script>
<script src="scm-tute_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="scm-tute_files/libs/quarto-html/anchor.min.js"></script>
<link href="scm-tute_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="scm-tute_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="scm-tute_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="scm-tute_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="scm-tute_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introduction to structural causal modelling</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction-to-structural-causal-modelling" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-structural-causal-modelling">Introduction to structural causal modelling</h2>
<p>A/Prof Christopher J. Brown</p>
<p><em>Institute for Marine and Antarctic Studies, University of Tasmania, Australia</em></p>
<p>2023-06-30</p>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<section id="what-you-need" class="level3">
<h3 class="anchored" data-anchor-id="what-you-need">What you need</h3>
<p>This is a workshop on structural causal modelling. It is designed to be run alone, or paired with a course on generalized linear models. It is designed to take about 1/2 a day to teach. The examples are drawn from ecology and conservation science, but the theory is applicable to any science, particularly if it is using observational data (rather than controlled experiments).</p>
<p>Before starting you will need to <a href="https://github.com/cbrown5/structural-causal-models-tutorial/blob/main/data/Kings-multistressor-experiment.csv"><strong>download this data</strong></a>.</p>
<p>You will need to install these R packages: <code>dagitty</code>, <code>tidyverse</code>, <code>ggdag</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"dagitty"</span>, <span class="st">"tidyverse"</span>, <span class="st">"ggdag"</span>, <span class="st">"visreg"</span>, <span class="st">"patchwork"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will cover some background theory, then we’ll launch into learning the approach with R. This course takes a philosophy of learning by doing, so we will mostly learn through doing the analyses.</p>
</section>
<section id="why-do-we-need-stuctural-causal-modelling" class="level3">
<h3 class="anchored" data-anchor-id="why-do-we-need-stuctural-causal-modelling">Why do we need stuctural causal modelling?</h3>
<p>A primary goal of science is to understand causes. Some contemporary examples in ecology and conservation include:</p>
<p>What caused a fish population to collapse? Was it overfishing or climate change or both?</p>
<p><a href="https://esajournals.onlinelibrary.wiley.com/doi/abs/10.1002/ecy.3070">Do ecosystem functions, like primary productivity, depend on species richness?</a></p>
<p><a href="https://esajournals.onlinelibrary.wiley.com/doi/10.1890/08-1034.1">Is temperature a cause of tree flowering and tree survival?</a></p>
<p>Causality also underpins questions about whether management interventions are working, like:</p>
<p><a href="https://doi.org/10.1016/j.biocon.2023.110105">Do entry fees to marine parks improve management and ecological outcomes?</a></p>
<p><a href="https://www.pnas.org/doi/10.1073/pnas.1704728114">Do oil palm plantations with sustainability certification have lower rates of rainforest loss?</a></p>
<p>Do total <a href="https://onlinelibrary.wiley.com/doi/full/10.1111/faf.12752">allowable catch limits result in sustainable fishery management?</a></p>
<p>Inferring causality is challenging because there are many potential confounding explanations for any observation we make. Therefore, conventional approaches hold that causality can only be inferred from manipulative experiments, specifically, randomized control trials. In such experiments the experimenter has control over different potential causes, so they can exclude some to study the hypothesized cause of interest.</p>
<p>Say we were interested to know if low light from pollution causes loss of seagrass meadows. We come up with a design where we compare the cover of seagrass in two estuaries, one estuary has good light, on estuary has low light. We find there is less seagrass in the estuary with low light. However, we cannot conclude that low light is a cause of seagrass loss, because there are many other ways the two estuaries could be different. For instance, they may be different sizes, have different tides and different levels of other human pressures, like boat anchoring.</p>
<p>Conventional approaches tell us we need to use a randomized control trial. So we pick large number of healthy estuaries and randomly allocate them treatment and control groups. In the treatment estuaries we dump a lot of pollution so as to reduce light levels. The control estuaries we leave as is. By randomizing we have removed confounders, because differences between estuaries are no longer correlated with low light.</p>
<p>However, clearly this design is unethical and logistically impossible.</p>
<p>So a more common approach is to change the scale. We work with small 1x1 metre plots instead of whole estuaries, and randomly allocate plots to shaded or unshaded treatments. This is much more practical (and ethically sound), but now we have changed the scale of our study. If we discover low light causes seagrass loss at the 1x1 metres scale, it will be hard to say if the same holds at the scale of a whole estuary.</p>
<p>In ecology and conservation many questions we need answers to are not amenable to randomized experimental designs. We can go out in the real world and make observations. We can often randomize when or where we take observations (such as choosing meadows to sample at random). But we cannot randomize application of treatments. So we need another way to ask causal questions.</p>
<p>Enter the logic of structural causal modelling.</p>
</section>
<section id="correlation-is-causation-with-some-conditions" class="level3">
<h3 class="anchored" data-anchor-id="correlation-is-causation-with-some-conditions">Correlation is causation, with some conditions</h3>
<p>Unfortunately we’ve had it drilled into our heads that correlation is not causation and we should never talk about causation when we are interpreting observational data.</p>
<p>By observational data I mean any data you collect that is not from a manipulative experiment that has randomized application of treatments. In fact, there is a grey area here, because many manipulative experiments also suffer from issues of confounding, as we will see later.</p>
<p>I’ve had numerous reviewers force me into softening language like: “fish biomass was higher in protected areas” or “greater warming caused faster rates of species migration”, into phrases like “fish biomass was associated with protection” or “greater warming was correlated with faster species migration”.</p>
<p>These reviewers are picking up on a debate that goes back to the late 1800s. You can read the details in <a href="https://www.amazon.com.au/Book-Why-Science-Cause-Effect/dp/046509760X">Pearl’s book on causation</a>. But the gist is that we are still influenced by long past statisticians, especially Fisher (inventor of p-values) and Pearson (inventor of correlation coefficient). Fisher effectively declared that correlation was not causation and that randomized control trials are the only way to infer causation. Then he viciously attacked anyone who proposed alternative methodologies.</p>
<p>Back in the early to mid 1900s there were alternative methods, like path analysis that was developed by Wright and taken further later on by social scientists, but these got lost to much of science (including ecology) thanks to the influence of people like Fisher.</p>
<p>Too bad for Fisher who was a chain smoker and died of lung cancer: he refused to believe that smoking was a cause of lung cancer, in part because there was not randomized control trial evidence.</p>
<p>But getting such evidence is impossible if not unethical. Randomly allocating people to smoking and non-smoking treatments then following them for years to see who gets cancer. So we need another way to study causation.</p>
<p>So know we are stuck with writing around what we really mean. Even though many studies are fundamentally about causation, we are not allowed to use those words. We have to say ‘association’ and let the reader put 2 and 2 together in their head. I think this is a source of much confusing.</p>
<p>Fortunately, social scientists and slightly more recently (since 1980s) artificial intelligence researchers continued to look at how we can infer causation from correlations in observational data.</p>
<p>What they’ve shown is that there is a very robust logic that can be used to infer causation from correlation. This logic is called <strong>Structural Causal Modelling</strong> (SCM) <a href="https://www.amazon.com.au/Book-Why-Science-Cause-Effect/dp/046509760X">Pearl</a>.</p>
<p>What SCM means for ecologists and conservation science is that we can now ask causal questions about our observational data. It also means we can stop beating around the bush when writing up our studies. We no longer need to say ‘associated’ when we actually mean ‘caused’.</p>
<p>All you have to do is follow the logic of SCM when developing your study and analysis. There’s also a few assumptions you need to know about that differ from the traditional assumptions we make when interpreting causation from randomized experiments.</p>
<p>There’s one further, <u>huge</u> bonus to SCM: we don’t need to learn any new statistical tests beyond the tests that ecologists normally learn, like generalized linear (or additive) models. SCM is totally compatible with our well honed approaches to studying associations.</p>
<p>Let’s get started</p>
</section>
</section>
<section id="scm-101" class="level2">
<h2 class="anchored" data-anchor-id="scm-101">SCM 101</h2>
<p>There are seven steps to SCM in ecology/conservation. My seven steps are <a href="https://esajournals.onlinelibrary.wiley.com/doi/abs/10.1002/ecm.1554">loosely based on five steps proposed by other authors</a>, with modifications based on my experience.</p>
<p>There’s roughly two versions of SCM out there right now as well. What I call SCM Classic and SCM Comprehensive.</p>
<p>The first five steps will lead us to a causal test of a particular relationship of interest, say do protected areas influence fish biomass? We then modify and repeat for different causes (step 6) or alternative hypotheses for the model (step 7). We will cover these:</p>
<ol type="1">
<li><strong>Create a conceptual model of your study system</strong></li>
<li><strong>Choose a statistical test</strong></li>
<li>Test consistency of your conceptual model with your data (optional)</li>
<li><strong>Identify confounding variables of you need to adjust for when testing the cause of interest</strong></li>
<li><strong>Test for causality with your statistical test</strong></li>
<li><strong>Repeat steps 3-5 above for other causes of interest</strong></li>
<li>Repeat steps 1-6 for other conceptual models</li>
</ol>
<p>We will cover steps 1,2,4,5,6 in this course. I call this approach that skips step 3 SCM Classic. You can add Step 3 for a full SCM-SEM approach “SCM Comprehensive”. SEM is already well covered <a href="https://jslefche.github.io/sem_book/index.html">elsewhere</a> so I will only cover it briefly here. Step 3 is also not essential for many applications of SCM, as we’ll see later.</p>
</section>
<section id="first-example" class="level2">
<h2 class="anchored" data-anchor-id="first-example">First example</h2>
<p>Let’s work through a complete example so you can see SCM in action. Then we will loop back and cover some more of the theory.</p>
<p>We will work with data from <a href="https://royalsocietypublishing.org/doi/10.1098/rspb.2022.0348">Olivia King’s multi-stressor experiment</a> (King et al.&nbsp;2022). Olivia was interested how low light and diuron, a herbicide, interact to affect algae. She set up an experiment where algae were exposed to combinations of different light levels and diuron. Then at increments over 72 hours she measured chlorophyll-a fluorescence (an indicator of ability to photosynthesize) and cell density (an indicator of cell abundance).</p>
<p>Our question here is how do diuron and light interact to affect fluorescence and cell density? Cell density should also be related to fluorescence, because cells with higher fluorescence should produce more energy for growth.</p>
<p>Variables in the dataset are: Time of measurement, Light level, Diuron level, experimental Block, t0 (density at time zero), lncelld (log of cell density), and PI (related to fluorescence). See <a href="https://royalsocietypublishing.org/doi/10.1098/rspb.2022.0348">King’s paper</a> and supplemental material for the original data and metadata.</p>
<p>Watch more <a href="https://www.youtube.com/watch?v=BA3wGE-0K8g">about the experiment</a></p>
<iframe src="https://www.youtube.com/embed/BA3wGE-0K8g" data-external="1">
</iframe>
<section id="step-1-define-a-conceptual-model-a-dag" class="level3">
<h3 class="anchored" data-anchor-id="step-1-define-a-conceptual-model-a-dag">Step 1 Define a conceptual model (a DAG)</h3>
<p>Let’s define our conceptual model first. We don’t need any data to do this, just some knowledge of the system. Formally, our model needs to be a ‘DAG’ -&gt; Directed Acyclical Graph. This means it has nodes representing variables, arrows representing causes. The arrows are directional. Also there can be no cycles ie the graph can’t be recursive.</p>
<p>We can represent our models as a series of formulas like normal R formulas. Then can check how it looks with the <code>ggdag</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdag)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'ggdag'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    filter</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_dag</span>())</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>king_mod <span class="ot">&lt;-</span> <span class="fu">dagify</span>(lncelld <span class="sc">~</span> PI <span class="sc">+</span> Diuron, </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                         PI <span class="sc">~</span> Light <span class="sc">+</span> Diuron) </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">ggdag</span>(king_mod, <span class="at">text_size =</span> <span class="dv">2</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">node_size =</span> <span class="dv">12</span>) </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>g1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In our hypothesized model PI (fluorescence) responds to light level, because more light generally = more photosynthesis. Diuron affects PI and cell density. Diuron blocks photosynthesis so should reduce PI. Diuron also causes cell damage so may have other direct effects on growth and cell density.</p>
<p>In the language of causal models we’d say that PI <strong>mediates</strong> the effect of light on cell density.</p>
<p>The arrows represent hypothesized causal effect that we’ll test later. By drawing them we are saying ‘this might be a cause’, we are not assuming it absolutely is a cause. We will test that assumption with the data.</p>
<p>Also note arrows now drawn. There is no arrow from light to lncelld. These undrawn arrows are our strongest assumptions. In this model we are assuming all the causal effects of light on cell density go via PI. So there is no other direct or indirect ways light can cause changes in lncelld.</p>
<p>Justifying the theory that underlies our DAG is key here. This theory is based on early studies and our understanding of causality in the system.</p>
<p>For instance, if you read <a href="https://royalsocietypublishing.org/doi/10.1098/rspb.2022.0348">King’s paper</a> and/or <a href="https://doi.org/10.3354/meps13717">her review</a> on effects of light and herbicides on marine primary producers, you will see she explains in the physiology of how Diuron can affect cell growth, e.g.&nbsp;an excerpt from the study’s discussion:</p>
<blockquote class="blockquote">
<p>Photosynthetic efficiency is strongly affected by diuron and other PSII-inhibiting herbicides, as these herbicides block electron transport in the PSII-complex, inhibiting photo- synthesis [48]. Thus, interactive effects for photosynthetic inhibition were observed much sooner at 2 h or less, com- pared to that of growth inhibition observed at 24 h or more.</p>
</blockquote>
<p>She’s written about the physiology processes underlying her hypothesized conceptual model (even though she didn’t formally create a DAG in that study) and supported these with references.</p>
<p>Let’s also load the data now, so we have it for later</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>king <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/Kings-multistressor-experiment.csv"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(king)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Time Light Diuron Block       t0    celld  lncelld        PI
1   72    20   0.11     2 35.24612 125.9434 4.835833 1.0123902
2   72    20   0.11     3 39.63470 114.6585 4.741958 0.9292967
3   72    20   0.11     4 34.61918 167.3215 5.119917 0.9773639
4   72    20   0.33     2 35.45510 126.7794 4.842448 1.0277136
5   72    20   0.33     3 45.69512 155.2006 5.044719 0.9501699
6   72    20   0.33     4 46.53104 162.7239 5.092055 0.9720600</code></pre>
</div>
</div>
<p>This abridged dataset only has measurements at the end of the experiment (72 hours), so we don’t need to consider time in our analysis.</p>
</section>
<section id="step-2-choose-a-statistical-test" class="level3">
<h3 class="anchored" data-anchor-id="step-2-choose-a-statistical-test">Step 2 Choose a statistical test</h3>
<p>Let’s work with general linear models for now. We will come back and fill in the modelling details later. For now, if you are not familiar with linear models, just know these are just simple regression models, but that allow for groups as inputs. We can implement them with the <code>lm</code> function in R.</p>
</section>
<section id="step-3-test-consistency-of-your-conceptual-model-with-your-data-optional" class="level3">
<h3 class="anchored" data-anchor-id="step-3-test-consistency-of-your-conceptual-model-with-your-data-optional">Step 3 Test consistency of your conceptual model with your data (optional)</h3>
<p>This step basically amounts to testing whether our assumptions about the undrawn arrows are consistent with the patterns in the data.</p>
<p>We won’t cover much of this step in this course, it would require another full day. This step basically amounts to structural equation modelling (SEM). But the theory you will learn in this course will help you understand structural equation modelling, because these models are also based on DAGs. But in brief, we can test whether our overall model structure is consistent with the data. The <code>piecewiseSEM</code> package is one way to do that. It asks whether there are any significant relationships in the data that aren’t explained by our DAG.</p>
<p>If you want the code for this data it would look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(piecewiseSEM)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>king_psem <span class="ot">&lt;-</span> <span class="fu">psem</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(lncelld <span class="sc">~</span> PI <span class="sc">+</span> Diuron, <span class="at">data =</span> king),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(PI <span class="sc">~</span> Diuron <span class="sc">+</span> Light,<span class="at">data =</span> king)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(king_psem)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will get from the summary an overall p-value telling us if the model is consistent with our data. Read more about SEM and piecewiseSEM in <a href="https://jslefche.github.io/sem_book/index.html">Jon Lefcheck’s live book</a> or the <a href="https://www.cambridge.org/core/books/cause-and-correlation-in-biology/247799189B31939D24BC0F61FD59E9BB">Bill Shipley book</a> and papers.</p>
</section>
<section id="step-4-identify-confounding-variables-of-you-need-to-adjust-for-when-testing-the-cause-of-interest" class="level3">
<h3 class="anchored" data-anchor-id="step-4-identify-confounding-variables-of-you-need-to-adjust-for-when-testing-the-cause-of-interest">Step 4 Identify confounding variables of you need to adjust for when testing the cause of interest</h3>
<p>Now we get to the structural causal modelling. At this step we want to put quantities on the arrows we’ve drawn, and test the causes.</p>
<p>Let’s look at an easy one first. How does light affect PI?</p>
<p>We can add our paths of interest to our plot with <code>ggdag_paths</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>king_mod <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdag_paths</span>(<span class="at">from=</span><span class="st">"Light"</span>, <span class="at">to =</span> <span class="st">"PI"</span>, <span class="at">shadow =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Obviously light only affects PI by one direct effect. Don’t worry about the ‘open path’ label, we’ll come back to that.</p>
<p>We can then use <code>dagitty</code> to identify adjustments sets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(king_mod,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"Light"</span>, </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"PI"</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"minimal"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">effect =</span> <span class="st">"total"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> {}</code></pre>
</div>
</div>
<p>No adjustment sets. We can also ask for canonical adjustment sets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(king_mod,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"Light"</span>, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"PI"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"canonical"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">effect =</span> <span class="st">"total"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{ Diuron }</code></pre>
</div>
</div>
<p>In this case conditioning on Diuron is optional. If we do that though we will get more power to detect a light effect, because conditioning on Diuron will help explain some of the residual variation.</p>
</section>
<section id="step-5-test-for-causality-with-your-statistical-test" class="level3">
<h3 class="anchored" data-anchor-id="step-5-test-for-causality-with-your-statistical-test">Step 5 Test for causality with your statistical test</h3>
<p>Now we know what do condition on, we just run the tests, same as any old R regression we would have done. The minimal one first:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>mod_pi_min <span class="ot">&lt;-</span> <span class="fu">lm</span>(PI <span class="sc">~</span>Light,<span class="at">data =</span> king)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_pi_min)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = PI ~ Light, data = king)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.41303 -0.13167 -0.06016  0.10073  0.39896 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  1.1513785  0.0448196  25.689  &lt; 2e-16 ***
Light       -0.0039417  0.0009397  -4.195 0.000134 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2043 on 43 degrees of freedom
Multiple R-squared:  0.2904,    Adjusted R-squared:  0.2739 
F-statistic:  17.6 on 1 and 43 DF,  p-value: 0.000134</code></pre>
</div>
</div>
<p>We see a significant negative effect of light on PI, ie more light, lower PI. You should also check standard model assumptions, which we’ll get to later.</p>
<p>So why bother doing the DAG and SCM when the above model is what we would have done anyway? Well in this trivial case it makes little difference. But in more complex cases the model to run will not be as obvious.</p>
<p>When our models are backed up by SCM we can make causal interpretations of the results. So rather than saying ‘lower PI was associated with higher light’, I can say ‘higher light <u>caused</u> lower PI’. This is really powerful change in language, especially if we are working with field datasets.</p>
<p>The statement of <u>caused</u> rests on the assumptions we made in drawing the DAG.</p>
<p>Let’s also look at a test with the canonical adjustment sets. In fact in this experiment Diuron and light treatments are crossed, so we should also consider an interaction between Diuron and light. The interaction is implicit in the DAG, because Diuron and Light both have arrows to PI.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(PI <span class="sc">~</span>Light <span class="sc">*</span> Diuron,<span class="at">data =</span> king) <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = PI ~ Light * Diuron, data = king)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.21978 -0.15899 -0.00171  0.08416  0.32268 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   1.2400393  0.0497432  24.929  &lt; 2e-16 ***
Light        -0.0040524  0.0010429  -3.886 0.000365 ***
Diuron       -0.0998433  0.0349629  -2.856 0.006710 ** 
Light:Diuron  0.0001248  0.0007330   0.170 0.865684    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1771 on 41 degrees of freedom
Multiple R-squared:  0.4912,    Adjusted R-squared:  0.454 
F-statistic:  13.2 on 3 and 41 DF,  p-value: 3.594e-06</code></pre>
</div>
</div>
</section>
<section id="step-6-repeat-for-other-causes" class="level3">
<h3 class="anchored" data-anchor-id="step-6-repeat-for-other-causes">Step 6 repeat for other causes</h3>
<p>So now we’ve seen how to applyl SCM to really obvious causal tests, let’s look at some more complex cases. A key difference with SCM and traditional ecostats is that we may have multiple different stats tests for the same variable. Each of these tests will be testing a different cause.</p>
<p>Let’s look at lncelld.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>king_mod <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdag_paths</span>(<span class="at">from=</span><span class="st">"Light"</span>, <span class="at">to =</span> <span class="st">"lncelld"</span>, <span class="at">shadow =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The adjustment set:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(king_mod,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"Light"</span>, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"lncelld"</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"canonical"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">effect =</span> <span class="st">"total"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{ Diuron }</code></pre>
</div>
</div>
<p>So we just do the test:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(lncelld <span class="sc">~</span> Light <span class="sc">*</span> Diuron,<span class="at">data =</span> king) <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lncelld ~ Light * Diuron, data = king)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.05478 -0.14454  0.02972  0.11077  0.72435 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   5.066505   0.077613  65.279  &lt; 2e-16 ***
Light        -0.001361   0.001627  -0.837  0.40770    
Diuron       -0.139207   0.054552  -2.552  0.01454 *  
Light:Diuron  0.003288   0.001144   2.875  0.00639 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2764 on 41 degrees of freedom
Multiple R-squared:  0.1991,    Adjusted R-squared:  0.1405 
F-statistic: 3.397 on 3 and 41 DF,  p-value: 0.02664</code></pre>
</div>
</div>
<p>This is the total effect of light on cell density. Note the interaction.</p>
<p>Now we can’t use the Diuron effects above just yet. We need to do the SCM:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>king_mod <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdag_paths</span>(<span class="at">from=</span><span class="st">"Diuron"</span>, <span class="at">to =</span> <span class="st">"lncelld"</span>, <span class="at">shadow =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now it gets slightly more interesting. There are two ways Diuron can have a casual effect on lncelld, directly and via PI.</p>
<p>The adjustment set:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(king_mod,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"Diuron"</span>, </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"lncelld"</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"canonical"</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">effect =</span> <span class="st">"total"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{ Light }</code></pre>
</div>
</div>
<p>That is the same test as we did above, so we make the causal interpretation of the Diuron by light interaction.</p>
<p>What if want to just know the direct effect of Diuron on cell density?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(king_mod,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"Diuron"</span>, </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"lncelld"</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"minimal"</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">effect =</span> <span class="st">"direct"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{ PI }</code></pre>
</div>
</div>
<p>We need to condition on PI. This is so we block (‘close’) the PI to cell density arrow. Then we are only estimating the effect of diuron on lncelld:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(lncelld <span class="sc">~</span> PI <span class="sc">+</span> Diuron,<span class="at">data =</span> king) <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lncelld ~ PI + Diuron, data = king)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.17329 -0.11575  0.03072  0.12553  0.56188 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  5.48814    0.22995  23.866   &lt;2e-16 ***
PI          -0.42731    0.20328  -2.102   0.0416 *  
Diuron      -0.06494    0.04335  -1.498   0.1416    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.289 on 42 degrees of freedom
Multiple R-squared:  0.1027,    Adjusted R-squared:  0.05996 
F-statistic: 2.403 on 2 and 42 DF,  p-value: 0.1028</code></pre>
</div>
</div>
<p>And we see Diuron has no direct effect on cell density.</p>
<p>Likewise if we want to know what the direct effect of PI on cell density is we should do this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(king_mod,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"PI"</span>, </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"lncelld"</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"minimal"</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">effect =</span> <span class="st">"direct"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{ Diuron }</code></pre>
</div>
</div>
<p>Which is just the same as the model we just did, where we saw PI has a negative effect on cell density.</p>
<p>If we took the traditional non-causal approach to this analysis, we might do a model like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(lncelld <span class="sc">~</span> Light <span class="sc">+</span> Diuron <span class="sc">+</span> PI,<span class="at">data =</span> king) <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lncelld ~ Light + Diuron + PI, data = king)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.17340 -0.10971  0.03593  0.12077  0.55742 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  5.515098   0.326919  16.870   &lt;2e-16 ***
Light       -0.000198   0.001686  -0.117   0.9071    
Diuron      -0.066677   0.046303  -1.440   0.1575    
PI          -0.445553   0.257782  -1.728   0.0914 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2925 on 41 degrees of freedom
Multiple R-squared:  0.103, Adjusted R-squared:  0.03736 
F-statistic: 1.569 on 3 and 41 DF,  p-value: 0.2114</code></pre>
</div>
</div>
<p>Note that our PI effect is no longer significant. That’s because we’ve <strong>over-controlled</strong> for PI, once via PI and once via its cause (light).</p>
<p>Finally, we can estimate the strength of the indirect effect of light on lncelld:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(king_mod,</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"Light"</span>, </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"lncelld"</span>,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"canonical"</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">effect =</span> <span class="st">"total"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{ Diuron }</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(lncelld <span class="sc">~</span> Light <span class="sc">*</span> Diuron,<span class="at">data =</span> king) <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lncelld ~ Light * Diuron, data = king)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.05478 -0.14454  0.02972  0.11077  0.72435 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   5.066505   0.077613  65.279  &lt; 2e-16 ***
Light        -0.001361   0.001627  -0.837  0.40770    
Diuron       -0.139207   0.054552  -2.552  0.01454 *  
Light:Diuron  0.003288   0.001144   2.875  0.00639 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2764 on 41 degrees of freedom
Multiple R-squared:  0.1991,    Adjusted R-squared:  0.1405 
F-statistic: 3.397 on 3 and 41 DF,  p-value: 0.02664</code></pre>
</div>
</div>
<p>Why does PI have a negative not positive effect? Well likely because the cells have been exposed to low light for 72 hours so have partially acclimated by increasing production of chlorophyll-a, to try and make up for the loss of light.</p>
<p>There is also the interaction to explain, but I’ll leave that there for today, read the paper if you want to know more.</p>
</section>
</section>
<section id="break-for-diy-dag-session" class="level2">
<h2 class="anchored" data-anchor-id="break-for-diy-dag-session">Break for DIY DAG session</h2>
<p>Now we’ll break from R code to work on DAGs for your own system. If you are doing this in your own time then have a go at drawing a DAG for your own system and coding it up to plot in R.</p>
</section>
<section id="more-on-using-dags-to-identify-causal-tests" class="level2">
<h2 class="anchored" data-anchor-id="more-on-using-dags-to-identify-causal-tests">More on using DAGs to identify causal tests</h2>
<p>So the first part we got a basic overview of how SCM works, but I skimmed over a lot of details. Now you have the overview, let’s go back and fill in some more theory with specific case-studies.</p>
<p>We won’t cover ever application of SCM, just give you an idea of what you can do. To learn more read the books by Pearl in the reference list.</p>
<section id="how-manipulative-experiments-work-to-infer-causality" class="level3">
<h3 class="anchored" data-anchor-id="how-manipulative-experiments-work-to-infer-causality">How manipulative experiments work to infer causality</h3>
<p>We saw an instance of confounding in King’s experiment, where the direct effect of diuron on cell density was confounded by its indirect effect via PI. In traditional statistics the only way we can infer causality is via a manipulative experiment (AKA randomized control design). King’s study was an experiment, so can’t we just use traditional stats to get at the causal direct effect of diuron?</p>
<p>The answer is no, because we didn’t control PI, we only controlled light and diuron.</p>
<p>If we were to do a controlled experiment to study the direct causal effect of diuron our DAG would look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>king_mod2 <span class="ot">&lt;-</span> ggdag<span class="sc">::</span><span class="fu">dagify</span>(lncelld <span class="sc">~</span> PI <span class="sc">+</span> Diuron, </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                         PI <span class="sc">~</span> Light ) </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="fu">ggdag</span>(king_mod2, <span class="at">text_size =</span> <span class="dv">2</span>,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">node_size =</span> <span class="dv">12</span>) </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>g1 <span class="sc">+</span> g2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># king_mod2 %&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggdag_paths(from="Diuron", to = "lncelld", shadow = TRUE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Left size is the original DAG, right side is our DAG without an effect of Diuron on lncelld. For the updated DAG we can just do <code>lm(lncelld ~ PI + Diuron)</code> and the model will tell us the direct effects of Diuron and PI on cell density.</p>
<p>How can an experiment remove an entire cause that exists in the real world (diuron effects PI)? Well through ‘control’. Our experimental setup for the new DAG would have to manipulate PI and then create a crossed design where we first grow cells with different PI levels then we dunk into them flasks with different diuron levels. That way we can artificially control PI by diuron combinations.</p>
<p>Clearly that wouldn’t be very practical and may introduce many other experimental artefacts.</p>
<p>The approach we used above was also to ‘control’ for PI, but we used statistical control rather than experimental control. With statistical control we can use the data we have to make causal inferences, without artificially manipulating variables. Sometimes that is a better way to go.</p>
<p>Statistical control really shines when we want to make causal inferences from observational data. So let’s look at an example of that next.</p>
</section>
<section id="confounding" class="level3">
<h3 class="anchored" data-anchor-id="confounding">Confounding</h3>
<p>SCM provides a definition for confounding. Confounding confuses many people and many statisticians aren’t even clear on its definition. We saw an example above with PI being confounded Diuron. Confounding is common in field studies where we have much less control over the environment.</p>
<p>Confounding means that two variables share a cause. This becomes a problem when we want to know the effect of each of those variables on an outcome.</p>
<p>Imagine King et al.’s study was a field study measuring the same variables by in a real estuary. Then we might expect diuron and Light to be strongly correlated with each other, because light will drop and diuron will rise whenever rain washes sediment and pesticides off of farmlands. Then our DAG will look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(Diuron<span class="sc">~</span> Rainfall,</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>       Light <span class="sc">~</span> Rainfall,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>       PI <span class="sc">~</span> Diuron <span class="sc">+</span> Light,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="at">Diuron =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">Light =</span> <span class="dv">1</span>, <span class="at">Rainfall =</span> <span class="dv">0</span>, <span class="at">PI =</span> <span class="dv">0</span>), </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> <span class="fu">c</span>(<span class="at">Diuron =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">Light =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">Rainfall =</span> <span class="dv">1</span>, <span class="at">PI =</span> <span class="sc">-</span><span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggdag</span>(<span class="at">text_size =</span> <span class="dv">3</span>,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">node_size =</span> <span class="dv">20</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Diuron and light are confounded because of the shared cause - rainfall. So when we measure water quality in the estuary we will see diuron levels and light are correlated. This means if we see lower values of PI it will be hard for us to tell if that is caused by higher diuron or low light, because both occur together.</p>
<p>King’s experiment removes the confounding having the experimenter randomly allocate flasks to diuron and light treatments. Let’s look at another example.</p>
</section>
<section id="an-urchin-case-study" class="level3">
<h3 class="anchored" data-anchor-id="an-urchin-case-study">An urchin case-study</h3>
<p>Let’s make up an example loosely based on a <a href="https://www.pnas.org/doi/10.1073/pnas.0907529106">case-study of sea urchins grazing kelp</a>.</p>
<p>In our example we hypothesize that warmer ocean temperatures will have a negative effect on kelp. Kelp is measured as % cover on quadrats taken on Tasmania’s east coast. Urchin larvae are travelling in warming waters down to Tasmania. We hypothesize that survival of sea urchin larvae will be higher when ocean temperature is warmer. Then greater larval survival means more urchins recruiting to the benthos. more urchins = less kelp, because they eat kelp.</p>
<p><img src="images/urchins.jpg" class="img-fluid"></p>
<p><strong>Image</strong>: Cracking good urchin barren (not in Tasmania).</p>
<p>Finally, there is no feedback of benthic urchins in Tasmania kelp forests back to larvae (at least initially), because the larvae are coming from mainland Australia.</p>
<p>Our model looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>urchinmod <span class="ot">&lt;-</span> <span class="fu">dagify</span>(Kelp <span class="sc">~</span> Urchins <span class="sc">+</span> Temp, </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                         Urchins <span class="sc">~</span> ULarvae, </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                         ULarvae <span class="sc">~</span> Temp,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="at">Kelp =</span> <span class="dv">1</span>, <span class="at">Urchins =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">Temp =</span> <span class="dv">1</span>, <span class="at">ULarvae =</span> <span class="dv">0</span>), </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> <span class="fu">c</span>(<span class="at">Kelp =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">Urchins =</span> <span class="sc">-</span><span class="fl">0.8</span>, <span class="at">Temp =</span> <span class="dv">1</span>, <span class="at">ULarvae =</span> <span class="dv">0</span>)) )</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag</span>(urchinmod, <span class="at">text_size =</span> <span class="dv">3</span>,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">node_size =</span> <span class="dv">20</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="statistical-control-applied-to-a-field-study" class="level3">
<h3 class="anchored" data-anchor-id="statistical-control-applied-to-a-field-study">Statistical control applied to a field study</h3>
<p>So we have data and a DAG. First step is to analyse the DAG with SCM. If we want to know if urchins are causing loss of kelp:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>urchinmod <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdag_paths</span>(<span class="at">from=</span><span class="st">"Urchins"</span>, <span class="at">to =</span> <span class="st">"Kelp"</span>, <span class="at">shadow =</span> <span class="cn">TRUE</span>, <span class="at">text_size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>There are two ways urchins can be related to kelp. Notice in the graph that both are labelled ‘open path’. Open path means there will be information flow, in other words these are different ways that kelp and urchins can be correlated. One is causal, the other is an example of correlation that isn’t causal.</p>
<p>The first path is the direct causal effect (herbivory) or urchins on kelp. The second path is not causal: Temperature affects both kelp and urchins (via their larvae), so kelp and urchins will be correlated, even without urchins grazing kelp.</p>
<p>So what the DAG is telling us is that the response of kelp to urchins is confounded by the response of kelp to temperature. This means if you did a field study and just counted kelp and urchins across some sites (say 100) you wouldn’t be able to tell if the cause of low kelp was more urchins or not. Sites that have more urchins may tend to have less kelp, but that could also be because urchin larve like warmer sites whereas kelp like cooler sites.</p>
<p>So we can use one of several approaches to separate cause and correlation for kelp cover.</p>
<p>Classic approaches would be to either modify the field design to control for climate or use a manipulative experiment. In the field design option, we could choose sites that all have the same temperature, so we are controlling for temperature. Then we survey across those sites and compare urchin and kelp cover. Then we could infer that a negative correlation means urchins cause kelp loss.</p>
<p>In the experimental option we would manipulate one aspect of the system, such as controlling urchin density. This would be a lot of effort because we would need to build exclusion cages to fence urchins out of patches of kelp, or manually manipulate urchin densities (this is in fact what ecologists often do!).</p>
<p>We could then pick a large number of sites and then flip a coin to see if they get urchin exclusion cages or not. We’ve randomise the application of the cages across a large number of sites. We can see urchins presence/absence correlates with kelp cover. The coin flip has broken the arrow from climate to kelp.</p>
<p>Either way, these design and manipulative controls change DAG so it removes the effects of temperature on urchins. Compare the original DAG with the DAG for an experimental design:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>urchinmod2 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(Kelp <span class="sc">~</span> Urchins <span class="sc">+</span> Temp, </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                         Urchins <span class="sc">~</span> coin_flip, </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                         ULarvae <span class="sc">~</span> Temp,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="at">Kelp =</span> <span class="dv">1</span>, <span class="at">Urchins =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">Temp =</span> <span class="dv">1</span>, <span class="at">ULarvae =</span> <span class="dv">0</span>, <span class="at">coin_flip=</span><span class="sc">-</span><span class="dv">1</span>), </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> <span class="fu">c</span>(<span class="at">Kelp =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">Urchins =</span> <span class="sc">-</span><span class="fl">0.8</span>, <span class="at">Temp =</span> <span class="dv">1</span>, <span class="at">ULarvae =</span> <span class="dv">0</span>, <span class="at">coin_flip=</span><span class="dv">1</span>))) </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag</span>(urchinmod, <span class="at">text_size =</span> <span class="dv">2</span>,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">node_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdag</span>(urchinmod2, <span class="at">text_size =</span> <span class="dv">2</span>,</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">node_size =</span> <span class="dv">15</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Once that connection is broken we no longer need to worry about confounding.</p>
<p>Let’s check our intuition against the casual analysis:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(urchinmod,</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"Urchins"</span>, </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"Kelp"</span>,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">effect =</span> <span class="st">"direct"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{ Temp }
{ ULarvae }</code></pre>
</div>
</div>
<p>The analysis tells us we need to control for either temperature or urchin larvae. SCM doesn’t care how we control for them, it could be by design or through manipulative experiment or via statistical control. That’s one nice aspect of SCM.</p>
<p>We could also use statistical control of temperature or larvae. This means that when we correlate kelp cover and urchin abundance we also include temperature as a covariate in our model. This is analogous to holding temperature constant by using a survey design that fixes temperature.</p>
<p>What about in the analysis of the manipulative experiment?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(urchinmod2,</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"Urchins"</span>, </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"Kelp"</span>,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">effect =</span> <span class="st">"direct"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> {}</code></pre>
</div>
</div>
<p>We don’t need to control for any confounders, because we used the experimental manipulation to do that already.</p>
<p>This case is simple enough that we don’t really need the DAG to figure out that climate is a confounder of kelp, and then what to do about the confounding. But in more complex cases our intuition may lead us astray. So we need to analyse a DAG.</p>
</section>
<section id="algorithms-for-identifying-adjustment-sets" class="level3">
<h3 class="anchored" data-anchor-id="algorithms-for-identifying-adjustment-sets">Algorithms for identifying adjustment sets</h3>
<p>The function <code>adjustmentSets</code> is applying an algorithm behind the scenes to determine what the adjustment sets are. This algorithm is called the back-door criteria and was developed using the logic of structural causal modelling. I recommend reading <a href="https://www.cambridge.org/core/books/causality/B0046844FAE10CBF274D4ACBDAEB5F5B">Pearl’s book</a> (or for a gentle introduction <a href="https://www.amazon.com.au/Book-Why-Science-Cause-Effect/dp/046509760X">read the pop science introduction to causality</a>) for more information on this logic, but here is a brief summary.</p>
<p>One of the great insights of structural causal modelling is that normal algebra doesn’t cut it for causality. Consider the equation:</p>
<p><code>kelp = b*urchins + c</code>. It says kelp cover is a function of a weight <code>b</code> times urchin density plus an intercept term (average kelp cover at zero urchins). The problem with normal rules of algebra is that it is ok to rearrange the equation: <code>urchins = (kelp - c)/b</code></p>
<p>Now we have put kelp as a cause of urchins. But we can’t just reverse causality like that. It’s like saying if we grow more kelp that will <strong>cause</strong> there to be fewer urchins!</p>
<p>Structural causal modelling is based on a logic that says causes always have to follow their effects. Pearl calls this ‘causal calculus’. Once you’ve established that logic, then we can derive rules for how to quantify causal relationships. The backdoor criterion is one of these rules that have been derived from causal calculus. Another one is the frontdoor criteria, and there are a few others we won’t cover.</p>
<p>I won’t go more into the theory than that, <a href="https://www.amazon.com.au/Book-Why-Science-Cause-Effect/dp/046509760X">Pearl does a much better job of explaining it than I can</a>. The point to highlight is that its all solidly based on rules of logic.</p>
<p>SCM does make some assumptions. A key one is that we’ve got the DAG right. That’s why its good to consider alternative DAG formulations.</p>
<p>I also want to emphasise one really remarkable thing about structural causal modelling and the causal calculus its based on. There are several assumptions it <strong>doesn’t</strong> make:</p>
<p><strong>Structural causal modelling makes no assumptions about the type of relationships between variables, it makes no assumptions about the type of test we use to test causal relationships</strong></p>
<p>This lack of assumptions about the type of test took me a while to get used to. Having been steeped in traditional statistical approaches, I was all about whether you use GLM or GAM, Bayesian or frequentist. SCM doesn’t care.</p>
<p>As you saw above SCM is equally applicable to designing experiments that use manipulative control as the mechanism for quantify causality, it is to designing field studies that will use statistical control to quantify causality.</p>
<p>Even if you believe that kelp is some crazy non-linear function of urchin abundance, the same rules of SCM and adjustment sets still apply as if you thought it was just a linear relationship. This freedom from the usual concerns of statisticians took me a while to come to grips with. But in the end SCM helps us focus on the bigger picture issues of study design and control, rather than the details of what type of test is best.</p>
<p>One we know the adjustment sets then it is up to use to choose how to do those tests. The assumptions of those specific tests then apply. But SCM doesn’t care which one we choose.</p>
<p>Let’s look at some more complex applications of SCM.</p>
</section>
<section id="missing-data" class="level3">
<h3 class="anchored" data-anchor-id="missing-data">Missing data</h3>
<p>You may have noticed for kelp that the adjustment set could be either urchin larvae or temperature, not both. So if we won’t to know about how urchins affect kelp we don’t need to measure everything in our DAG. We just need to measure outcomes, a hypothesized causes and its adjustment sets. This can help you prioritise variables for a field study, or give you power to analyse questions others thought were impossible.</p>
<p>Note that if you want to test whether you overall DAG is consistent with data (step 3 that I haven’t covered here), then you usually will need to have measured everything (though there are exceptions that structural equation modelling can deal with).</p>
<p>The front door criteria is a good example of how we can overcome data gaps. The classic example is smoking as a cause of lung cancer. I’ll reframe that as an ecological example here.</p>
<p>Back to our kelp example, what if we want to know the effect of larval survival on kelp cover. Further, we can measure larval survival (through larval surveys), urchin density and kelp cover, but not ocean temperature? Or, perhaps more plausibly, we aren’t sure which component of ocean climate is important for kelp and urchin larval survival?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>urchinmod <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdag_paths</span>(<span class="at">from=</span><span class="st">"ULarvae"</span>, <span class="at">to =</span> <span class="st">"Kelp"</span>, <span class="at">shadow =</span> <span class="cn">TRUE</span>, <span class="at">text_size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We want to quantify the left hand path (larvae to urchins to kelp), but it will be confounded by the right hand path (correlation between larvae and kelp, caused by climate variables).</p>
<p>Let’s look at the adjustment sets for larvae to kelp:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(urchinmod,</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">"ULarvae"</span>, </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">"Kelp"</span>,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"minimal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{ Temp }</code></pre>
</div>
</div>
<p>The backdoor criteria says that at the very least we need to be able to control for ocean temperature. But we said we don’t know temperature.</p>
<p>In the case of this DAG, we can use the front-door instead. The front-door just says quantify all the direct paths. So we quantify larvae to urchins (e.g.&nbsp;correlation) then quantify urchins to kelp. Now the total effect of larvae on kelp is just the product of the two direct causes.</p>
<p>The calculations for the front-door criteria rest on the maths of structural equation modelling, which I won’t go into any further here. See the references below if you are interested to learn more about this method.</p>
</section>
<section id="other-algorithms-for-identifying-adjustment-sets" class="level3">
<h3 class="anchored" data-anchor-id="other-algorithms-for-identifying-adjustment-sets">Other algorithms for identifying adjustment sets</h3>
<p>There are three main algorithms for identifying adjustment sets: back-door criteria, front-door criteria, instrumental variables. The <code>adjustmentSets</code> functions uses the book-door criteria. It is worth learning the other two (see references below) so you have tools to solve problems when the book-door won’t work. There are also situations where none of the algorithms will work, but you still may be able to find a solution by applying the causal calculus by hand. This advanced topic is covered in the references.</p>
</section>
<section id="colliders" class="level3">
<h3 class="anchored" data-anchor-id="colliders">Colliders</h3>
<p>Prepare yourself with coffee and sugar for one of the most confusing and difficult to understand aspects of causal logic: collider variables.</p>
<p>We’ll step through a simple example to make this as easy as possible. But suffice to say collider variables are a logic that is very counter-intuitive to our simple human brains. This is exactly why we need SCM to help us understand and deal with them.</p>
<p>We’ve already discussed two ways you can put three variables together in a DAG: mediation and correlation (confounding). The third is the collider. Let’s look at one.</p>
<p>In our example we are interested in the effect of exposure to waves on fish diversity. We are doing field observations. But we have inadvertently selected survey sites that are easy to get to and have higher fish diversity:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>fishdag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(Survey <span class="sc">~</span> Diversity <span class="sc">+</span> Exposure,</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="at">Survey =</span> <span class="dv">0</span>, <span class="at">Diversity =</span> <span class="dv">1</span>, <span class="at">Exposure=</span><span class="sc">-</span><span class="dv">1</span>), </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> <span class="fu">c</span>(<span class="at">Survey =</span> <span class="dv">0</span>, <span class="at">Diversity =</span> <span class="dv">1</span>, <span class="at">Exposure=</span><span class="dv">1</span>))) </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>fishdag <span class="sc">%&gt;%</span> <span class="fu">ggdag_collider</span>(<span class="at">text_size =</span> <span class="fl">2.5</span>,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">node_size =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>So selection of sites to survey (‘Survey’) depends on exposure and diversity. This could easily happen. Say we asked our supervisor about good sites to visit that span a range of different exposures. They suggest some of the ‘best’ study sites, but inadvertently these tend to be places with better fish diversity (where they like to dive). Then it comes to the field work and we are limited in our ability to visit all sites by days of bad weather. So we end up being biased towards less exposed sites.</p>
<p><img src="images/fish.jpg" class="img-fluid"></p>
<p><strong>Image</strong>: Its hard not to be drawn to nice sheltered sites with lots of fish</p>
<p>Without realising it our study design is now influenced by exposure and diversity, the very two variables we are interested in studying. Our design implicitly <strong>conditions on</strong> exposure and diversity.</p>
<p>When we come to do our analysis, we will just do a regression of diversity against exposure. But because of the collider we accidentally created, <strong>we will tend to see an effect of exposure on diversity, even if one doesn’t really exist</strong>.</p>
<p>Let’s see this issue in action. We’ll simulate some data and then apply two survey designs, one that selects sites at random, and another that is biased by exposure and diversity:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">35</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>fishdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">diversity =</span> <span class="fu">rpois</span>(n, <span class="dv">10</span>),</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="fu">rnorm</span>(n))</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>fishdat <span class="ot">&lt;-</span> <span class="fu">within</span>(fishdat, {</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  surv_prob <span class="ot">=</span> <span class="fu">plogis</span>(<span class="fl">0.5</span><span class="sc">*</span>exposure <span class="sc">+</span> <span class="fl">0.1</span><span class="sc">*</span>diversity)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  surveyed <span class="ot">=</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, surv_prob)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>fishdat_biased <span class="ot">&lt;-</span> fishdat[fishdat<span class="sc">$</span>surveyed<span class="sc">==</span><span class="dv">1</span>,]</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>nbiased <span class="ot">&lt;-</span> <span class="fu">nrow</span>(fishdat_biased)</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>nbiased</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 356</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>rand_select <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(fishdat), <span class="at">size =</span> nbiased, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>fishdat_random <span class="ot">&lt;-</span> fishdat[rand_select,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Selection of sites is biased by exposure and diversity:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fishdat) <span class="sc">+</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> exposure, <span class="at">y =</span> diversity, <span class="at">colour =</span> surv_prob) <span class="sc">+</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>So most sites selected for surveys in the</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(fishdat_random, <span class="fu">cor.test</span>(diversity, exposure))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  diversity and exposure
t = 0.4827, df = 354, p-value = 0.6296
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 -0.07850422  0.12924370
sample estimates:
       cor 
0.02564665 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(fishdat_biased, <span class="fu">cor.test</span>(diversity, exposure))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  diversity and exposure
t = 2.0602, df = 354, p-value = 0.04011
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.004961745 0.210408279
sample estimates:
      cor 
0.1088472 </code></pre>
</div>
</div>
<p>So the correlation is significant for the biased survey and non-significant for the random selection of sites.</p>
<p>Collider bias is very poorly studied in ecology, so there are probably some great papers that should be written uncovering examples of collider bias and false inferences of causality!</p>
<p>I can think of three general ways collider bias could happen in ecology. The first would be biased survey site selection, as we’ve just seen.</p>
<p>The second would be model misspecification.</p>
<p>Imagine the following scenario. Exposure and fish diversity are both causes of habitat cover in the real world (left hand model). But we think that habitat cover is a mediator of fish diversity (right hand model). We go ahead and regress fish diversity on exposure, to estimate the total effect of exposure. That regression will be subject to collider bias.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>fishdag2 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(Habitat <span class="sc">~</span> Diversity <span class="sc">+</span> Exposure,</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="at">Habitat =</span> <span class="dv">0</span>, <span class="at">Diversity =</span> <span class="dv">1</span>, <span class="at">Exposure=</span><span class="sc">-</span><span class="dv">1</span>), </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> <span class="fu">c</span>(<span class="at">Habitat =</span> <span class="dv">0</span>, <span class="at">Diversity =</span> <span class="dv">1</span>, <span class="at">Exposure=</span><span class="dv">1</span>))) </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>fishdag3 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(Diversity <span class="sc">~</span> Habitat,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>                   Habitat <span class="sc">~</span> Exposure,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="at">Habitat =</span> <span class="dv">0</span>, <span class="at">Diversity =</span> <span class="dv">1</span>, <span class="at">Exposure=</span><span class="sc">-</span><span class="dv">1</span>), </span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> <span class="fu">c</span>(<span class="at">Habitat =</span> <span class="dv">0</span>, <span class="at">Diversity =</span> <span class="dv">1</span>, <span class="at">Exposure=</span><span class="dv">1</span>))) </span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="fu">ggdag</span>(fishdag2, <span class="at">text_size =</span> <span class="fl">2.5</span>,</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">node_size =</span> <span class="dv">15</span>)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>g3 <span class="ot">&lt;-</span> <span class="fu">ggdag</span>(fishdag3, <span class="at">text_size =</span> <span class="fl">2.5</span>,</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">node_size =</span> <span class="dv">15</span>)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>g2 <span class="sc">+</span> g3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The third general way collider bias could happen is just through the sloppy statistical practice of making ‘causal soups’ (McElreath). Casual soup is a multivariate regression where you just throw in every covariate you think could be vaguely important for your response variable. It’s the kind of practice that proponents of machine learning methods often encourage.</p>
<p>If you try to interpret effects in these these causal soup models you are likely to run into issues with collider bias (and confounding).</p>
</section>
<section id="m-bias" class="level3">
<h3 class="anchored" data-anchor-id="m-bias">M bias</h3>
<p>Collider bias is a complex topic and we’ve only just scraped the surface. It’s worth mentioning that colliders come in many different coats. One of those is M bias:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag_m_bias</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The variable m in this graph is a collider that will induce false correlations if we regress x on y. Here’s an example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>mpadag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(survey <span class="sc">~</span> access <span class="sc">+</span> exposure,</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>                 MPA <span class="sc">~</span> exposure,</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                 diversity <span class="sc">~</span> access)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>g4 <span class="ot">&lt;-</span> <span class="fu">ggdag</span>(mpadag, <span class="at">text_size =</span> <span class="fl">1.6</span>,</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">node_size =</span> <span class="dv">12</span>)</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>mpadag <span class="sc">%&gt;%</span> <span class="fu">ggdag_collider</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>So it helps to use the algorithms we’ve learnt here when analysing complex DAGs.</p>
<p>The simulation we applied above is a useful tool to explore collider bias. If you think it may be an issue you can explore how much of an issue through a simulation study. This will help you figure out if your results will be robust to collider bias or not.</p>
</section>
</section>
<section id="application-of-generalized-linear-models-in-scm" class="level2">
<h2 class="anchored" data-anchor-id="application-of-generalized-linear-models-in-scm">Application of generalized linear models in SCM</h2>
<p>Now let’s apply work through a full case-study and apply GLMs to the analysis.</p>
<p><a href="https://www.seascapemodels.org/rstats/2018/01/19/intro-to-glms.html">If you need to quickly learn the basics of GLMs start here</a> then <a href="https://www.seascapemodels.org/rstats/2018/10/16/understanding-the-glm-link.html">read this article on link functions</a>.</p>
<section id="gaussian-glm---urchin-larvea" class="level3">
<h3 class="anchored" data-anchor-id="gaussian-glm---urchin-larvea">Gaussian GLM - urchin larvea</h3>
<p>Now we’ll simulate some data that represents our urchin DAG. I’m going to add an extra twist and say urchin abundance also depends on the type of benthic structure (rock) which will be a categorical variable with two levels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>urchinmod <span class="ot">&lt;-</span> <span class="fu">dagify</span>(Kelp <span class="sc">~</span> Urchins <span class="sc">+</span> Temp, </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>                         Urchins <span class="sc">~</span> ULarvae <span class="sc">+</span> Rock, </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>                         ULarvae <span class="sc">~</span> Temp)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag</span>(urchinmod, <span class="at">text_size =</span> <span class="dv">3</span>,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">node_size =</span> <span class="dv">20</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I’ve plucked these numbers out of thin air and tuned them to give approximately sensible scales.</p>
<p>Let’s see how to simulate data for larvae first. We’ll assume its normally distributed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>udat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Temp =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">16</span>, <span class="at">sd =</span> <span class="dv">1</span>))</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>udat <span class="ot">&lt;-</span> <span class="fu">within</span>(udat, {</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  ULarvae_hat <span class="ot">=</span> <span class="dv">1</span><span class="sc">*</span>Temp <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  ULarvae <span class="ot">=</span> ULarvae_hat <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">sd =</span> <span class="fl">0.4</span>)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(udat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visreg) </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>mlarvae <span class="ot">&lt;-</span> <span class="fu">glm</span>(ULarvae <span class="sc">~</span> Temp, <span class="at">data =</span> udat)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(mlarvae)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)        Temp 
  0.2664466   0.9231934 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(mlarvae)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                2.5 %   97.5 %
(Intercept) -1.146238 1.679131
Temp         0.834928 1.011459</code></pre>
</div>
</div>
<p>The slope is close to the value we choose of 1 and within the 95% CIs.</p>
<p>We should verify the model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mlarvae)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you want the full summary:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mlarvae)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = ULarvae ~ Temp, data = udat)

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.26645    0.72077    0.37    0.713    
Temp         0.92319    0.04503   20.50   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for gaussian family taken to be 0.1317621)

    Null deviance: 61.6967  on 49  degrees of freedom
Residual deviance:  6.3246  on 48  degrees of freedom
AIC: 44.515

Number of Fisher Scoring iterations: 2</code></pre>
</div>
</div>
</section>
<section id="poisson-glm---urchin-abundance" class="level3">
<h3 class="anchored" data-anchor-id="poisson-glm---urchin-abundance">Poisson GLM - urchin abundance</h3>
<p>Let’s add urchin adults to the simulated data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">105</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>udat <span class="ot">&lt;-</span> <span class="fu">within</span>(udat, {</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  Rock <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">each =</span> n<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  Urchins_hat <span class="ot">=</span> <span class="fu">exp</span>(<span class="fl">0.25</span><span class="sc">*</span>ULarvae <span class="sc">+</span> <span class="fl">0.3</span><span class="sc">*</span>Rock<span class="fl">-0.5</span>)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  Urchins <span class="ot">=</span> <span class="fu">rpois</span>(n, Urchins_hat)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(udat) <span class="sc">+</span> </span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> ULarvae, <span class="at">y =</span> Urchins, <span class="at">color =</span> Rock) <span class="sc">+</span> </span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Before we do a regression, let’s do our SCM to check adjustment sets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(urchinmod, <span class="at">exposure =</span> <span class="st">"ULarvae"</span>, </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">outcome =</span> <span class="st">"Urchins"</span>,</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">type =</span> <span class="st">"minimal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> {}</code></pre>
</div>
</div>
<p>You could also use canonical which will tell you can include rock in the same model (which may also be of interest).</p>
<p>The model looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>murchin <span class="ot">&lt;-</span> <span class="fu">glm</span>(Urchins <span class="sc">~</span> Rock <span class="sc">+</span> ULarvae, <span class="at">data =</span> udat,</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="st">"poisson"</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="fu">visreg</span>(murchin, <span class="at">xvar =</span> <span class="st">"ULarvae"</span>, <span class="at">by =</span> <span class="st">"Rock"</span>,</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">scale =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Once again we should verify the model. There are</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(murchin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We should also check the ratio of the residual deviance and residual degrees of freedom, we want it to be near 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(murchin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Urchins ~ Rock + ULarvae, family = "poisson", data = udat)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -1.25831    0.40378  -3.116  0.00183 ** 
Rock         0.35788    0.05368   6.667 2.61e-11 ***
ULarvae      0.29668    0.02570  11.543  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 197.375  on 49  degrees of freedom
Residual deviance:  41.868  on 47  degrees of freedom
AIC: 308.09

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
</section>
<section id="binomial-glm---kelp" class="level3">
<h3 class="anchored" data-anchor-id="binomial-glm---kelp">Binomial GLM - Kelp</h3>
<p>Let’s add kelp now, assuming it was observed using method of point intersect transects (so counts out of 100</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>nPIT <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>udat <span class="ot">&lt;-</span> <span class="fu">within</span>(udat, {</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  Kelp_hat <span class="ot">&lt;-</span> <span class="fu">plogis</span>(<span class="sc">-</span><span class="fl">0.1</span><span class="sc">*</span>Temp <span class="sc">-</span> <span class="fl">0.1</span><span class="sc">*</span> Urchins <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  Kelp <span class="ot">=</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> nPIT, </span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>                Kelp_hat)</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(udat) <span class="sc">+</span> </span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Urchins, <span class="at">y =</span> Kelp, <span class="at">color =</span> Temp) <span class="sc">+</span> </span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Before we do a regression, let’s do our SCM to check adjustment sets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(urchinmod, <span class="at">exposure =</span> <span class="st">"Urchins"</span>, </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">outcome =</span> <span class="st">"Kelp"</span>,</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">type =</span> <span class="st">"minimal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{ Temp }
{ ULarvae }</code></pre>
</div>
</div>
<p>So we need to control for temperature and the effect of temperature on urchins</p>
<p>The model looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>Kelp2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(udat<span class="sc">$</span>Kelp, nPIT <span class="sc">-</span> udat<span class="sc">$</span>Kelp)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>mkelp <span class="ot">&lt;-</span> <span class="fu">glm</span>(Kelp2 <span class="sc">~</span>  Urchins <span class="sc">+</span> Temp <span class="sc">+</span> ULarvae, <span class="at">data =</span> udat,</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="fu">visreg</span>(mkelp, <span class="at">xvar =</span> <span class="st">"Urchins"</span>,<span class="at">by =</span> <span class="st">"Temp"</span>,</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">scale =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Once again we should verify the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mkelp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Kelp2 ~ Urchins + Temp + ULarvae, family = "binomial", 
    data = udat)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  4.31315    1.29381   3.334 0.000857 ***
Urchins     -0.08357    0.01534  -5.449 5.06e-08 ***
Temp         0.20848    0.21675   0.962 0.336133    
ULarvae     -0.58869    0.26253  -2.242 0.024939 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 247.348  on 49  degrees of freedom
Residual deviance:  39.022  on 46  degrees of freedom
AIC: 171.28

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(mkelp) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)     Urchins        Temp     ULarvae 
 4.31315407 -0.08357394  0.20848134 -0.58869163 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(mkelp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %      97.5 %
(Intercept)  1.8091612  6.88626692
Urchins     -0.1142222 -0.05408482
Temp        -0.2206145  0.62965593
ULarvae     -1.1033261 -0.07307449</code></pre>
</div>
</div>
<p>We were expecting the urchin effect to be around -0.1 (what we set it as in the simulation).</p>
<p>Let’s see what happens if we ignore the confounders:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>mkelp_biased <span class="ot">&lt;-</span> <span class="fu">glm</span>(Kelp2 <span class="sc">~</span>  Urchins, <span class="at">data =</span> udat,</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(mkelp_biased)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept)      Urchins 
 0.007506986 -0.123157043 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(mkelp_biased)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %     97.5 %
(Intercept) -0.4714943  0.4966802
Urchins     -0.1450516 -0.1025890</code></pre>
</div>
</div>
<p>We still get the direction right, but our estimate is a touch too high. If you play around with including/excluding Temp and ULarvae you will see that including just one confounder is sufficient in this case.</p>
<p><img src="images/kelp.JPG" class="img-fluid"></p>
<p><strong>Image:</strong> Kelp, sans urchins</p>
</section>
<section id="collider-example---effect-of-temp-on-urchins" class="level3">
<h3 class="anchored" data-anchor-id="collider-example---effect-of-temp-on-urchins">Collider example - effect of Temp on urchins</h3>
<p>Let’s do an example where we mistakenly condition on a collider.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(urchinmod, <span class="at">exposure =</span> <span class="st">"Temp"</span>, </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">outcome =</span> <span class="st">"Urchins"</span>,</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">type =</span> <span class="st">"canonical"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{ Rock }</code></pre>
</div>
</div>
<p>Notice what isn’t in the canonical set - Kelp.</p>
<p>The adjustment sets will tell you what you should adjust for <strong>but it won’t tell you what you should not adjust for</strong>. That is, it won’t warn you of colliders. We can check for potential colliders with <code>paths()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paths</span>(urchinmod, <span class="at">from =</span> <span class="st">"Temp"</span>, <span class="at">to =</span> <span class="st">"Urchins"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$paths
[1] "Temp -&gt; Kelp &lt;- Urchins"    "Temp -&gt; ULarvae -&gt; Urchins"

$open
[1] FALSE  TRUE</code></pre>
</div>
</div>
<p>Notice there are two paths from Temperature to Kelp. One is open, meaning there is information flow (either causally or via confounding). One is closed, meaning there is no information flow. Paths are closed by colliders. We don’t want to condition on a closed path, that will add information where there is none!</p>
<p>But its a mistake that would be easy to make. In this case its easy to see an ecologist would think: “urchins eat kelp, so therefore if there is more kelp there are more urchins”. But in doing so they get causality the wrong way around (at least for our DAG and simulated data).</p>
<p>Let’s see what happens if decide they need to put kelp in their model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>murchin_collider <span class="ot">&lt;-</span> <span class="fu">glm</span>(Urchins <span class="sc">~</span>  Temp <span class="sc">+</span> Kelp, <span class="at">data =</span> udat,</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="st">"poisson"</span>)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(murchin_collider)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)        Temp        Kelp 
 3.00487091  0.04098105 -0.06816798 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(murchin_collider)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                  2.5 %      97.5 %
(Intercept)  1.86193107  4.15350847
Temp        -0.02726040  0.10873638
Kelp        -0.08787598 -0.04877496</code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">visreg</span>(murchin_collider, <span class="at">xvar =</span> <span class="st">"Temp"</span>, <span class="at">scale =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The effect of temperature is not even significant. So we conclude no effect of ocean temperature on sea urchin abundance.</p>
<p>But this was caused by the collider. Let’s do it the right way, with no conditioning:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>murchin_nocollider <span class="ot">&lt;-</span> <span class="fu">glm</span>(Urchins <span class="sc">~</span>  Temp, <span class="at">data =</span> udat,</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="st">"poisson"</span>)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(murchin_nocollider)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)        Temp 
 -0.0327617   0.2148325 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(murchin_nocollider)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %    97.5 %
(Intercept) -0.7752627 0.7032273
Temp         0.1695244 0.2603892</code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">visreg</span>(murchin_nocollider, <span class="at">xvar =</span> <span class="st">"Temp"</span>, <span class="at">scale =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="scm-tute_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Better, now there is a strong positive effect of temp on urchin abundance.</p>
<p>But urchins do eat kelp, and presumably this would mean they become more abundance. So how do we deal with predator-prey feedbacks in a DAG?<br>
We can discuss in the workshop. It has to do with time-series.</p>
</section>
<section id="confounding-example---direct-effect-of-temp" class="level3">
<h3 class="anchored" data-anchor-id="confounding-example---direct-effect-of-temp">Confounding example - direct effect of Temp</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(urchinmod, <span class="at">exposure =</span> <span class="st">"Temp"</span>, </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">outcome =</span> <span class="st">"Kelp"</span>,</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">effect =</span> <span class="st">"direct"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{ Urchins }
{ ULarvae }</code></pre>
</div>
</div>
<p>So we need to control for <u>either</u> Urchins or urchin larvae.</p>
<p>Let’s see what happens if we don’t do that first. The direct effect of temperature on kelp should be about -0.1, what we said it was:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>mkelp_temp_biased <span class="ot">&lt;-</span> <span class="fu">glm</span>(Kelp2 <span class="sc">~</span>  Temp, <span class="at">data =</span> udat,</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(mkelp_temp_biased)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)        Temp 
  8.4126766  -0.7441843 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(mkelp_temp_biased)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %     97.5 %
(Intercept)  6.5589682 10.2788991
Temp        -0.8681699 -0.6221239</code></pre>
</div>
</div>
<p>Way too high, we are actually estimating the total effect of temperature in this model, that is its direct effect plus its indirect effect via urchins (change ‘direct’ to ‘total’ to see this is the model for total.</p>
<p>Now let’s block the Urchin effect:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>mkelp_temp <span class="ot">&lt;-</span> <span class="fu">glm</span>(Kelp2 <span class="sc">~</span>  Temp <span class="sc">+</span> Urchins, <span class="at">data =</span> udat,</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(mkelp_temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)        Temp     Urchins 
 3.06406689 -0.24088509 -0.09618201 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(mkelp_temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %      97.5 %
(Intercept)  0.8445491  5.31267406
Temp        -0.4151187 -0.06996047
Urchins     -0.1247373 -0.06902464</code></pre>
</div>
</div>
<p>its quite uncertain, but at least its in the 95%CI range now.</p>
<p>We can also block the indirect effect with ULarvae. Try this, what happens then? Why is the result different.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>So there’s a very brief overview of SCM and applications to designing studies and tests with GLMs.</p>
<p>I’ve only brushed the surface here, to give you a taste of what SCM can do. I recommend checking out the reading below if you are interested to go further.</p>
<p>SCM is a useful tool to use when designing any study and at the start of developing an analysis. Benefits of SCM include:</p>
<ul>
<li><p>It will help you think about what variables you need to measure and control for.</p></li>
<li><p>It can help you design a manipulative study that controls for the right things and doesn’t induce bias by controlling for the wrong things.</p></li>
<li><p>You can identify variables you need to measure so you can control for them statistically</p></li>
<li><p>You can identify variables you don’t need to measure (that maybe you assumed you did) to answer your causal question of interest</p></li>
<li><p>It will help you think about and avoid bias</p></li>
<li><p>It will help your audience visualize your assumptions</p></li>
</ul>
<p>There’s a big focus on model selection in ecology, using stats like the AIC. You will notice I haven’t mentioned those tools here. If you draw a DAG that’s justified by prior evidence and theory there’s really no need for model selection routines. The DAG will tell you what variables to test. So while you have to do more tests for different causal hypotheses, you won’t need to compare as many nested models.</p>
<p>Model selection in DAG land is about considering different models. You might have multiple competing DAGs you consider are equally valid. In that case it is good to do your SCM for each one. <a href="https://doi.org/10.1016/j.biocon.2023.110105">In one study I did this and found most of my results were robust</a>to changes in the DAG structure (the adjustment sets were the same, see <a href="https://doi.org/10.1016/j.biocon.2023.110105">Figure 2 of the linked paper</a>. This gave me greater confidence in my results.</p>
<p>So I encourage you to consider multiple models.</p>
<p>SCM can also be used to study outcomes of interventions. It lets you ask the counterfactual question: what would have happened if we didn’t do this (make an MPA, have a TAC, sign up for sustainability certification etc…). [In this way SCM is related to matching designs that are becoming increasingly popular in conservation studies](A guide to quasi-experimental approaches in ecology including backdoor and frontdoor criteria](https://doi.org/10.1002/ecs2.4009)</p>
<p><strong>The best thing about SCM is it allows you to talk causally about your analyses.</strong> No more beating around the bush with the weak language of ‘associations’.</p>
<p>When you write causally you are bound to meet critics and reviewers who want you to change everything to ‘association’ . It will take some education (one reason I’m doing this course, to educate people!).</p>
<p>SCM is based on thorough logical reasoning of how to infer causes from correlations. It is just as thorough as traditional statistical practice. If you follow the rules of SCM then you can talk causally. So if if someone wants to criticize you for that, then you can politely refer them to the literature.</p>
<p>If you follow SCM, a critic of your casual reasoning can really only attack it on the grounds that your DAG is wrong, or your tests are inappropriate (e.g.&nbsp;used gaussian when it should have been poisson, or linear instead of non-linear). So invite them to study your DAG and suggest alternative formulations.</p>
</section>
<section id="further-reading" class="level2">
<h2 class="anchored" data-anchor-id="further-reading">Further reading</h2>
<ul>
<li><p><a href="https://doi.org/10.1098/rspb.2022.0348">King et al.’s study of diuron and light effects on algae</a></p></li>
<li><p>Review of SCM in Ecology: <a href="https://esajournals.onlinelibrary.wiley.com/doi/abs/10.1002/ecm.1554">Applying the structural causal model (SCM) framework for observational causal inference in ecology</a></p></li>
<li><p><a href="https://www.cambridge.org/core/books/cause-and-correlation-in-biology/247799189B31939D24BC0F61FD59E9BB">Introduction to structural equation modelling</a> Also a great introduction to the study of causation in general</p></li>
<li><p><a href="https://jslefche.github.io/sem_book/index.html">Another great live online SEM textbook</a></p></li>
<li><p><a href="https://besjournals.onlinelibrary.wiley.com/doi/10.1111/2041-210X.12512">piecewiseSEM</a> for SEM in R</p></li>
<li><p><a href="https://esajournals.onlinelibrary.wiley.com/doi/10.1890/08-1034.1">The original piecewise SEM study</a></p></li>
<li><p>A pop-science, easy to read <a href="https://www.amazon.com.au/Book-Why-Science-Cause-Effect/dp/046509760X">Introduction to SCM</a></p></li>
<li><p><a href="https://www.amazon.com.au/Causality-Judea-Pearl/dp/052189560X">SCM text book</a></p></li>
<li><p><a href="https://doi.org/10.1002/ecs2.4009">A guide to quasi-experimental approaches in ecology including backdoor and frontdoor criteria</a></p></li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>